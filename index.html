<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDE Member Registration</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        .form-input {
            transition: all 0.3s ease;
        }
        .form-input:focus {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.15);
        }
        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="glass rounded-3xl shadow-2xl p-8 w-full max-w-md">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-white rounded-full mx-auto mb-4 flex items-center justify-center shadow-lg">
                    <i class="fas fa-users text-3xl text-purple-600"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">Welcome to BDE</h1>
                <p class="text-purple-100">Register now to join our team</p>
            </div>

            <!-- Form -->
            <form id="registrationForm" class="space-y-6">
                <!-- Full Name -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">
                        <i class="fas fa-user mr-2"></i>Full Name
                    </label>
                    <input type="text" id="fullName" name="full_name" required
                        class="form-input w-full px-4 py-3 rounded-xl border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-300"
                        placeholder="Enter your full name">
                </div>

                <!-- Email -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">
                        <i class="fas fa-envelope mr-2"></i>Email Address
                    </label>
                    <input type="email" id="email" name="email" required
                        class="form-input w-full px-4 py-3 rounded-xl border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-300"
                        placeholder="example@email.com">
                </div>

                <!-- WhatsApp -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">
                        <i class="fab fa-whatsapp mr-2"></i>WhatsApp Number
                    </label>
                    <input type="tel" id="whatsapp" name="whatsapp" required
                        class="form-input w-full px-4 py-3 rounded-xl border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-300"
                        placeholder="+212 6XX XXX XXX">
                </div>

                <!-- Filiere -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">
                        <i class="fas fa-graduation-cap mr-2"></i>Field of Study (Filiere)
                    </label>
                    <select id="filiere" name="filiere" required
                        class="form-input w-full px-4 py-3 rounded-xl border-0 bg-white/90 text-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-300">
                        <option value="">Select your field</option>
                        <option value="DAI">DAI</option>
                        <option value="PME">PME</option>
                        <option value="ESA">ESA</option>
                        <option value="EII">EII</option>
                    </select>
                </div>

                <!-- Niveau -->
                <div>
                    <label class="block text-white text-sm font-medium mb-2">
                        <i class="fas fa-layer-group mr-2"></i>Academic Level
                    </label>
                    <select id="niveau" name="niveau" required
                        class="form-input w-full px-4 py-3 rounded-xl border-0 bg-white/90 text-gray-800 focus:outline-none focus:ring-2 focus:ring-purple-300">
                        <option value="">Select your level</option>
                        <option value="1st Year">1st Year</option>
                        <option value="2nd Year">2nd Year</option>
                    </select>
                </div>

                <!-- Role -->
               <!-- Role -->
<div>
    <label class="block text-white text-sm font-medium mb-2">
        <i class="fas fa-briefcase mr-2"></i>Role *
    </label>
    <input type="text" id="role" name="role" required
        class="form-input w-full px-4 py-3 rounded-xl border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-300"
        placeholder="Enter your role">
</div>


                <!-- Submit Button -->
                <button type="submit" id="submitBtn"
                    class="btn-primary w-full py-4 rounded-xl text-white font-bold text-lg shadow-lg">
                    <i class="fas fa-paper-plane mr-2"></i>
                    <span id="btnText">Join Now</span>
                </button>
            </form>

            <!-- Success Message -->
            <div id="successMessage" class="hidden mt-6 p-4 bg-green-500/90 text-white rounded-xl text-center">
                <i class="fas fa-check-circle text-2xl mb-2"></i>
                <p class="font-bold">Registration Successful!</p>
                <p class="text-sm mt-1">Welcome to the BDE team</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden mt-6 p-4 bg-red-500/90 text-white rounded-xl text-center">
                <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                <p class="font-bold" id="errorText">An error occurred</p>
            </div>

            <!-- Admin Link -->
            <div class="text-center mt-8">
                <a href="/admin" class="text-purple-200 hover:text-white text-sm transition-colors">
                    <i class="fas fa-cog mr-1"></i>Admin Panel
                </a>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('registrationForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const successMsg = document.getElementById('successMessage');
        const errorMsg = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Change button state
            submitBtn.disabled = true;
            btnText.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Registering...';
            
            // Hide messages
            successMsg.classList.add('hidden');
            errorMsg.classList.add('hidden');

            try {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                // Basic client-side validation
                if (!data.full_name || !data.email || !data.whatsapp || !data.filiere || !data.niveau || !data.role) {
                    errorText.textContent = 'All fields are required';
                    errorMsg.classList.remove('hidden');
                    return;
                }

                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(data.email)) {
                    errorText.textContent = 'Please enter a valid email address';
                    errorMsg.classList.remove('hidden');
                    return;
                }

                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    // Registration successful
                    form.classList.add('success-animation');
                    successMsg.classList.remove('hidden');
                    form.reset();
                    
                    // Auto WhatsApp message
                    setTimeout(() => {
                        const whatsappMsg = `Hello! I've successfully registered for BDE as ${data.role} in ${data.filiere}. Thank you! ðŸŽ‰`;
                        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(whatsappMsg)}`;
                        window.open(whatsappUrl, '_blank');
                    }, 2000);
                    
                } else {
                    // Registration failed
                    errorText.textContent = result.message || 'Registration failed';
                    errorMsg.classList.remove('hidden');
                }

            } catch (error) {
                console.error('Registration error:', error);
                errorText.textContent = 'Connection error with server. Please check your internet connection and try again.';
                errorMsg.classList.remove('hidden');
            } finally {
                // Reset button state
                submitBtn.disabled = false;
                btnText.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Join Now';
            }
        });

        // Format phone number
        document.getElementById('whatsapp').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('212')) {
                value = '+' + value;
            } else if (value.startsWith('0')) {
                value = '+212' + value.substring(1);
            } else if (value.startsWith('6') || value.startsWith('7')) {
                value = '+212' + value;
            }
            e.target.value = value;
        });
    </script>
</body>
</html>
